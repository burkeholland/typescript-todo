// create an expressjs router file
import express, { Router } from 'express';
import Todo from '../models/Todo';
import TodoService from '../services/todoService';

const router: Router = express.Router();

router.get('/', async (req, res) => {
  const todos = await TodoService.getTodos();
  res.render('index', { todos });
});

router.post('/todo/delete/:id', async (req, res) => {
  const id = req.params.id;
  await TodoService.deleteTodoById(id);
  res.redirect('/');
});

router.post('/todo/create', async (req, res) => {
  const newTodo: string = req.body.newTodo;
  await TodoService.addTodo({ title: newTodo, isCompleted: false });
  res.redirect('/');
});

router.post('/todo/update/:id', async (req, res) => {
  const id = req.params.id;
  const todoToUpdate = {
    id: id,
    title: req.body.title,
    isCompleted: req.body.isCompleted,
  };

  await TodoService.updateTodoById(id, todoToUpdate);

  res.redirect('/');
});

export default router;
